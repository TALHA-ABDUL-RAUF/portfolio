---
const {
  title,
  image,
  link,
  organization,
  logo,
  color = "from-green-400 via-emerald-500 to-teal-400"
} = Astro.props;

/* Precompute class strings to avoid inline template parsing issues */
const outerClasses = "group relative transform transition-all duration-1000 hover:scale-105 hover:z-50";
const parallaxLayer = "absolute inset-0 transform group-hover:translate-y-1 group-hover:translate-x-1 transition-transform duration-700";

/* main wrapper with safe gradient classes */
const containerGradient = `bg-gradient-to-br ${color}`;
const wrapperClasses = `relative rounded-2xl p-[3px] ${containerGradient} transition-all duration-700`;

/* inner card */
const innerCardClasses =
  "bg-gray-900/95 rounded-2xl p-6 flex flex-col items-center gap-4 text-center backdrop-blur-md relative overflow-hidden border border-emerald-500/20 group-hover:border-emerald-500/40 transition-all duration-500";

/* logo image classes (use safe Tailwind sizes) */
const logoImgBase = "w-20 h-20 rounded-full shadow-2xl transition-all duration-600 z-10 relative";
const logoHoverExtras = " group-hover:scale-110 group-hover:rotate-[12deg] group-hover:shadow-[0_0_35px_rgba(110,231,183,0.6)]";

/* particle / misc utility classes kept in markup */
---
<div class={outerClasses}>
  <!-- 3D Parallax Effect -->
  <div class={parallaxLayer}></div>
  
  <!-- Multi-layer Animated Border -->
  <div class="absolute -inset-2 bg-gradient-to-r from-green-400 via-emerald-500 to-teal-400 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-1000 animate-rotate-3d"></div>
  <div class="absolute -inset-1 bg-gradient-to-r from-teal-400 via-emerald-500 to-green-400 rounded-2xl opacity-0 group-hover:opacity-80 transition-opacity duration-800 animate-rotate-3d-reverse" style="animation-delay: 0.5s"></div>

  <!-- Holographic Particles System -->
  <div class="absolute -inset-6 opacity-0 group-hover:opacity-100 transition-opacity duration-1200">
    <div class="absolute w-2 h-2 bg-emerald-500 rounded-full animate-particle-float" style="top: 15%; left: 10%; animation-delay: 0s;"></div>
    <div class="absolute w-1.5 h-1.5 bg-teal-400 rounded-full animate-particle-float" style="top: 65%; left: 85%; animation-delay: 0.4s;"></div>
    <div class="absolute w-1 h-1 bg-green-500 rounded-full animate-particle-float" style="top: 35%; left: 55%; animation-delay: 0.8s;"></div>
    <div class="absolute w-1.5 h-1.5 bg-emerald-400 rounded-full animate-particle-float" style="top: 75%; left: 25%; animation-delay: 1.2s;"></div>
  </div>

  <!-- Main Card Container -->
  <div class={wrapperClasses}>
    <!-- Animated Background Glow -->
    <div class={`absolute -inset-4 ${containerGradient} rounded-2xl blur-2xl opacity-0 group-hover:opacity-40 transition-opacity duration-900`}></div>
    
    <!-- Quantum Grid Overlay -->
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(110,231,183,0.1)_0%,transparent_70%)] opacity-0 group-hover:opacity-100 transition-opacity duration-1000"></div>
    
    <div class={innerCardClasses}>
      
      <!-- Animated Circuit Pattern -->
      <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIwLjUiIGZpbGw9IiMxYTFhMWEiLz48L3N2Zz4=')] opacity-0 group-hover:opacity-30 transition-opacity duration-700"></div>

      <!-- Logo with Advanced Effects (SAFE) -->
      {logo ? (
        <div class="relative">
          <div class="absolute -inset-3 bg-emerald-500/20 rounded-full blur-lg opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>

          <!-- <--- IMPORTANT: using class={computed} prevents parser errors --->
          <img 
            src={logo} 
            alt={organization ?? ''} 
            class={logoImgBase + logoHoverExtras}
          />

          <div class="absolute inset-0 rounded-full border-2 border-emerald-500/30 opacity-0 group-hover:opacity-100 group-hover:animate-ping-slow transition-opacity duration-500"></div>
        </div>
      ) : null }

      <!-- Title with Text Glow -->
      <div class="flex flex-col items-center gap-1 z-10 relative">
        <h3 class="text-lg font-semibold text-white group-hover:text-emerald-300 group-hover:drop-shadow-[0_0_15px_rgba(110,231,183,0.7)] transition-all duration-500">{title}</h3>
        {organization ? (
          <p class="text-sm text-gray-400 group-hover:text-emerald-300 group-hover:drop-shadow-[0_0_8px_rgba(110,231,183,0.5)] transition-all duration-500">Issued by {organization}</p>
        ) : null}
      </div>  

      <!-- Certificate Image with 3D Effect -->
      <div class="relative transform group-hover:perspective-1000 group-hover:rotate-x-5 transition-all duration-800">
        <img 
          src={image}
          alt={title} 
          class="w-full h-56 object-cover rounded-xl shadow-2xl group-hover:scale-105 group-hover:shadow-[0_0_40px_rgba(110,231,183,0.5)] group-hover:brightness-110 transition-all duration-600 z-10 relative"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/50 to-transparent rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
      </div>

      <!-- Advanced Animated Link -->
      {link ? (
        <a 
          href={link} 
          target="_blank" 
          rel="noopener noreferrer" 
          class="text-sm text-teal-300 hover:text-white underline transition-colors duration-400 z-10 group-hover:scale-110 group-hover:text-emerald-300 relative overflow-hidden"
        >
          <span class="absolute inset-0 bg-gradient-to-r from-emerald-500/30 to-teal-500/30 transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></span>
          <span class="relative">View Certificate</span>
        </a>
      ) : null}
    </div>
  </div>
</div>

<style>
/* your original keyframes and helper classes (no change) */
@keyframes rotate-3d {
  0% { transform: rotateY(0deg) scale(1); opacity: 0.6; }
  50% { transform: rotateY(180deg) scale(1.1); opacity: 0.8; }
  100% { transform: rotateY(360deg) scale(1); opacity: 0.6; }
}
@keyframes rotate-3d-reverse {
  0% { transform: rotateX(0deg) scale(1); opacity: 0.4; }
  50% { transform: rotateX(180deg) scale(1.05); opacity: 0.6; }
  100% { transform: rotateX(360deg) scale(1); opacity: 0.4; }
}
@keyframes particle-float {
  0%, 100% { transform: translateY(0) translateX(0) rotate(0deg) scale(1); opacity: 0.7; }
  33% { transform: translateY(-12px) translateX(8px) rotate(120deg) scale(1.2); opacity: 1; }
  66% { transform: translateY(6px) translateX(-10px) rotate(240deg) scale(0.8); opacity: 0.5; }
}
@keyframes ping-slow {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(3); opacity: 0; }
}
.animate-rotate-3d {
  animation: rotate-3d 4s linear infinite;
}
.animate-rotate-3d-reverse {
  animation: rotate-3d-reverse 5s linear infinite;
}
.animate-particle-float {
  animation: particle-float 6s ease-in-out infinite;
}
.animate-ping-slow {
  animation: ping-slow 2s ease-out infinite;
}
.perspective-1000 {
  perspective: 1000px;
}
.rotate-x-5 {
  transform: rotateX(5deg);
}
</style>
